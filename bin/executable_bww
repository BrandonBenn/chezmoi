#!/bin/sh -ef

trap 'trap - INT; kill -s HUP -- -$$' INT

ensure_installed() {
    for program in "bw" "fzf"; do
        if ! command -v "$program" >/dev/null; then
            printf "The %s program is missing.\n" "$program"
            exit 1
        fi
    done
}

bw_items() {
    bw login
    bw list items | jq '.[].name' --raw-output |
        fzf --cycle --layout=reverse --border --ansi \
            --preview 'bw get item {} | jq'
}

bw_get() {
    entries=$(bw_items)
    bw list items --search "$entries" |
        jq '.[0].login.password' --raw-output
}

ensure_installed
password=$(bw_get)
printf "%s\n" "$password"
